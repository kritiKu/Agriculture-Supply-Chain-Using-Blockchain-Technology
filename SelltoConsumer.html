<DOCTYPE html>
<html>
<head>
	<script src="https://code.jquery.com/jquery-3.4.1.js"
		integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.2.6/dist/web3.min.js"></script>
	
	<link href="./stylesheet/selltoconsumer.css" rel='stylesheet' type='text/css'>
    </head>  
    <body>
        <div class="form" id="sign-up-form">
            <h2 class="form-title">Sell To Consumer</h2>
            <input type="text" class="input-std" id="rid" placeholder="Retailor Id">
            <input type="text" class="input-std" id="productid" placeholder="Product Id">
            <input type="text" class="input-std" id="productname" placeholder="Product Name">
            <input type="text" class="input-std" id="quantity" placeholder="Quantity">
            <input type="text" class="input-std" id="price" placeholder= "Price ">
            <input type="submit" class="btn-submit" value="Submit Details" id="SubmitDetails"><br><br><br>

            <input type="text" class="input-std" id="sid" placeholder="Serial Id">
            <input type="button" class="btn-submit" value="Get Details" id="get_details"><br><br>
 
             <div>
                 <p id="retailor_Id"></p>
                 <p id="product_Id"></p>
                 <p id="product_name"></p>
                 <p id="Product_Quantity"></p>
                 <p id="Expected_Price"></p>
             </div>
        
          </div>

          <script type="text/javascript">

            var web3;
                    if (typeof web3 !== 'undefined') {
                            web3 = new Web3(web3.currentProvider);
                    }
                    else {
                        web3 = new Web3(new Web3.providers.HttpProvider("http://127.0.0.1:7545"));
                
                    }
                    console.log(web3);
                   
                    web3.eth.defaultAccount = web3.eth.accounts[0];
            
                    //var contract;
                    //var address = "0x4e8f75a6f64107d9cf9b3e5d087fd3162e45700a";
                    var abi = [
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_serialId",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_consumer_id",
				"type": "uint256"
			}
		],
		"name": "buyByConsumerId",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_retailorId",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_productId",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "_product_name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_quantity",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_price",
				"type": "string"
			}
		],
		"name": "SellToConsumerConnect",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "entryMap4",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "retailor_id",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "consumer_id",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "product_id",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "product_name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "quantity",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "Price",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "SeialId",
				"type": "uint256"
			},
			{
				"internalType": "bool",
				"name": "bought",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "Sell_To_ConsumerMap",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_retailorId",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_consumerId",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_productId",
				"type": "uint256"
			}
		],
		"name": "SellToConsumerShow",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "ShowAllSellToConsumer",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "_totalSellToConsumer",
				"type": "uint256"
			},
			{
				"internalType": "uint256[]",
				"name": "_serial_id",
				"type": "uint256[]"
			},
			{
				"internalType": "uint256[]",
				"name": "_retailor_id",
				"type": "uint256[]"
			},
			{
				"internalType": "uint256[]",
				"name": "_consumer_id",
				"type": "uint256[]"
			},
			{
				"internalType": "uint256[]",
				"name": "_product_id",
				"type": "uint256[]"
			},
			{
				"internalType": "string[]",
				"name": "_product_name",
				"type": "string[]"
			},
			{
				"internalType": "string[]",
				"name": "_quantity",
				"type": "string[]"
			},
			{
				"internalType": "string[]",
				"name": "_Price",
				"type": "string[]"
			},
			{
				"internalType": "bool[]",
				"name": "_bought",
				"type": "bool[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_serialId",
				"type": "uint256"
			}
		],
		"name": "showSellToConsumerBySerialId",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
]
contract = new web3.eth.Contract(abi, "0x58b74ec9652FC3c4B9B5D16031BE89cA834559c8");
                
                
$(document).ready(function () {
    $("#SubmitDetails").click(function () {
            console.log("Submit Details has been clicked!")
            // Blockchain call
                    
            var rid = $("#rid").val();	
            var productid = $("#productid").val();
            var productname = $("#productname").val();
            var quantity = $("#quantity").val();
            var price = $("#price").val();

            console.log(rid, productid, productname, quantity, price);	

       contract.methods.SellToConsumerConnect(rid, productid, productname, quantity, price ).send({ 
       from: "0xf3A1D302C8e95077637C6De781181d4716B25326",
       })
       .then(function (trx ) {
        console.log(trx);
        alert("successfully added");
        });
    }); 

        $("#get_details").click(function () {
        console.log("Get Details has been clicked!")
        // Blockchain cal
        //var acnt = $("#farmer_address").val();
        var sid = $("#sid").val();
  
 
        console.log(sid);
        contract.methods.showSellToConsumerBySerialId(sid).call(function(error, result){ 
        console.log(result);

        let product_name = result[0];
        let Product_Quantity = result[1];
        let Expected_Price = result[2];

     
        document.getElementById("product_name").innerHTML = "product_Name: " + product_name;
        document.getElementById("Product_Quantity").innerHTML = "Product_Quantity:" + Product_Quantity;
        document.getElementById("Expected_Price").innerHTML ="Expected_Price: " + Expected_Price;
    });        


   });
});          
                        

</script>
       </body>
</html>